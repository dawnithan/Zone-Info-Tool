<!DOCTYPE html>
<html>
<head>
	<title>Zone Info Tool</title>
	<!-- Map CSS -->
	<link rel="stylesheet" type="text/css" href="map.css">

	<!-- Leaflet CSS + Leaflet JS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
	
	<!-- Leaflet EasyButton CSS + JS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	
	<!-- JQuery -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
	<!-- ERSI ArcGis -->
	<script src="https://unpkg.com/esri-leaflet@2.1.2/dist/esri-leaflet.js"></script>
	
	<!-- Turf.js --> 
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>
</head>
<body>
	
<div id="mapid"></div>
<div id="info-pane" class="leaflet-bar">This is an info pane. <br> Click a point on the <br>map to place a pin <br>with a radius of 1km.</div>

<script>
var map = L.map('mapid').setView([51.8977, -8.4706], 14);

var marker = L.marker();
var circle = L.circle();
var info = L.control();

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	maxZoom: 18,
	attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
		'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
	id: 'mapbox.streets'
}).addTo(map);

L.esri.featureLayer({
    url: 'https://services6.arcgis.com/uWTLlTypaM5QTKd2/arcgis/rest/services/EDs_CSO/FeatureServer/1',
	simplifyFactor: 0.5,
	style: { color: 'gray' }
  }).addTo(map);
  
L.easyButton('<span class="delete">&cross;</span>', function() {
	map.removeLayer(circle);
	map.removeLayer(marker);
	console.log("Zone removed.");
}, title="Remove Current Zone").addTo(map);

map.on('click', onMapClick);

info.onAdd = function (map) {
	this._div = L.DomUtil.create('div', 'info'); //create div with class 'info'
	this.update();
	return this._div;
};

info.update = function (props) {
    this._div.innerHTML = "";
};

info.addTo(map);

// Spatial analysis: [1] https://github.com/turfjs/turf 
//					 [2] https://esri.github.io/esri-leaflet/examples/spatial-queries.html

function onMapClick(e) {
    marker.setLatLng(e.latlng).addTo(map);
    if(circle != undefined) {
    	map.removeLayer(circle);
    }
    circle = L.circle(e.latlng, {
    	color: '#9e7c83',
    	fillColor: '#f03',
    	fillOpacity: 0.2,
    	radius: 1000
    }).addTo(map);
    marker.bindPopup("<h3>This is a test popup.</h3>This is where information from a database might show up."+"<br><br>"+e.latlng);
}	
</script>

</body>
</html>